<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastrar Horário - Escola One</title>
  <link rel="stylesheet" href="design-system.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      background: hsl(var(--background));
      margin: 0;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: hsl(var(--card));
      border-bottom: 1px solid hsl(var(--border));
      padding: 1rem 2rem;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;
      box-sizing: border-box;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      width: 50px;
      height: 50px;
      border-radius: calc(var(--radius) * 2);
      overflow: hidden;
      background: hsl(var(--primary) / 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .brand-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: hsl(var(--foreground));
    }

    .brand-text .brand {
      color: hsl(var(--primary));
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .header-nav .nav-link {
      color: hsl(var(--muted-foreground));
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      transition: all 0.2s ease;
    }

    .header-nav .nav-link:hover {
      color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    .header-nav .nav-link.active {
      color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    /* Main Content */
    .main-content {
      margin-top: 70px;
      padding: 2rem;
      min-height: calc(100vh - 70px);
      display: flex;
      justify-content: center;
    }

    .form-container {
      width: 100%;
      max-width: 800px;
    }

    /* Breadcrumb */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
    }

    .breadcrumb a {
      color: hsl(var(--primary));
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .breadcrumb-separator {
      color: hsl(var(--muted-foreground));
    }

    /* Page Header */
    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-icon {
      width: 48px;
      height: 48px;
      background: hsl(var(--primary) / 0.1);
      color: hsl(var(--primary));
      border-radius: calc(var(--radius) * 1.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-icon svg {
      width: 24px;
      height: 24px;
    }

    .page-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .page-subtitle {
      color: hsl(var(--muted-foreground));
      font-size: 0.875rem;
      margin: 0.25rem 0 0 0;
    }

    .back-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: hsl(var(--muted) / 0.5);
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      color: hsl(var(--foreground));
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .back-button:hover {
      background: hsl(var(--muted));
      transform: translateX(-2px);
    }

    .back-button svg {
      width: 16px;
      height: 16px;
    }

    /* Form Card */
    .form-card {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      padding: 2rem;
      box-shadow: 0 4px 6px -1px hsl(var(--primary) / 0.1);
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid hsl(var(--border));
    }

    .section-icon {
      width: 20px;
      height: 20px;
      color: hsl(var(--primary));
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: 600;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .section-description {
      color: hsl(var(--muted-foreground));
      font-size: 0.875rem;
      margin: 0.25rem 0 0 0;
    }

    /* Form Grid */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }

    .form-grid.two-columns {
      grid-template-columns: repeat(2, 1fr);
    }

    .form-grid.three-columns {
      grid-template-columns: repeat(3, 1fr);
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    /* Form Actions */
    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid hsl(var(--border));
    }

    /* Success Message */
    .success-message {
      background: hsl(120 100% 95%);
      color: hsl(120 100% 30%);
      border: 1px solid hsl(120 100% 85%);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: none;
    }

    [data-theme="dark"] .success-message {
      background: hsl(120 100% 10%);
      color: hsl(120 100% 70%);
      border-color: hsl(120 100% 20%);
    }

    /* Error Message */
    .error-message {
      background: hsl(0 100% 95%);
      color: hsl(0 100% 40%);
      border: 1px solid hsl(0 100% 85%);
      border-radius: var(--radius);
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: none;
    }

    [data-theme="dark"] .error-message {
      background: hsl(0 100% 10%);
      color: hsl(0 100% 70%);
      border-color: hsl(0 100% 20%);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .header-nav {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 1rem;
      }

      .main-content {
        padding: 1rem;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .form-grid.two-columns,
      .form-grid.three-columns {
        grid-template-columns: 1fr;
      }

      .form-actions {
        flex-direction: column;
      }

      .form-card {
        padding: 1.5rem;
      }
    }

  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Background Circle -->
          <circle cx="25" cy="25" r="25" fill="url(#logoGradient)"/>
          
          <!-- Book Icon -->
          <path d="M15 18C15 16.8954 15.8954 16 17 16H33C34.1046 16 35 16.8954 35 18V32C35 33.1046 34.1046 34 33 34H17C15.8954 34 15 33.1046 15 32V18Z" fill="white" fill-opacity="0.9"/>
          <path d="M18 20H32V22H18V20Z" fill="hsl(220 14% 96%)"/>
          <path d="M18 24H28V26H18V24Z" fill="hsl(220 14% 96%)"/>
          <path d="M18 28H30V30H18V28Z" fill="hsl(220 14% 96%)"/>
          
          <!-- Graduation Cap -->
          <path d="M25 12L35 16L25 20L15 16L25 12Z" fill="white"/>
          <path d="M32 18V22C32 23.1046 28.4183 24 25 24C21.5817 24 18 23.1046 18 22V18" stroke="white" stroke-width="1.5" fill="none"/>
          
          <!-- Number "1" -->
          <circle cx="39" cy="12" r="6" fill="white" fill-opacity="0.9"/>
          <text x="39" y="16" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="hsl(220 14% 20%)" text-anchor="middle">1</text>
          
          <!-- Gradient Definition -->
          <defs>
            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div class="brand-text">
        <span class="brand">Escola</span> One
      </div>
    </div>

    <nav class="header-nav">
      <a href="painel.html" class="nav-link">Home</a>
      <a href="alunos.html" class="nav-link">Alunos</a>
      <a href="encarregados.html" class="nav-link">Encarregados</a>
      <a href="professores.html" class="nav-link">Professores</a>
      <a href="disciplinas.html" class="nav-link">Disciplinas</a>
      <a href="turmas.html" class="nav-link">Turmas</a>
      <a href="horarios.html" class="nav-link active">Horários</a>
      <button id="theme-toggle" class="nav-link" style="background: none; border: none; cursor: pointer;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
        </svg>
      </button>
      <a href="#" class="nav-link" onclick="if(confirm('Tem certeza que deseja sair do sistema?')) { authManager.logout(); } return false;">Logout</a>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="form-container" id="app">
      <!-- Breadcrumb -->
      
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-title-section">
          <div class="page-icon">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 6v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div>
            <h1 class="page-title">{{ isEditMode ? 'Editar Horário' : 'Cadastrar Horário' }}</h1>
            <p class="page-subtitle">{{ isEditMode ? 'Edite as informações do horário' : 'Adicione um novo horário ao sistema' }}</p>
          </div>
        </div>
        <a href="horarios.html" class="back-button">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
          Voltar à Lista
        </a>
      </div>

      <!-- Success Message -->
      <div class="success-message" id="successMessage">
        {{ isEditMode ? 'Horário atualizado com sucesso!' : 'Horário cadastrado com sucesso!' }}
      </div>

      <!-- Error Message -->
      <div class="error-message" id="errorMessage">
        {{ isEditMode ? 'Erro ao atualizar horário. Verifique os dados e tente novamente.' : 'Erro ao cadastrar horário. Verifique os dados e tente novamente.' }}
      </div>

      <!-- Form Card -->
      <div class="form-card">
        <form @submit.prevent="submitForm">
          <!-- Schedule Information Section -->
          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" viewBox="0 0 24 24" fill="currentColor">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <div>
                <h2 class="section-title">{{ isEditMode ? 'Editar Horário' : 'Informações do Horário' }}</h2>
                <p class="section-description">{{ isEditMode ? 'Edite as informações do horário abaixo.' : 'Preencha todos os campos obrigatórios para cadastrar um novo horário.' }}</p>
              </div>
            </div>

            <div class="form-grid two-columns">
              <div class="form-group">
                <label for="turma" class="label">Turma *</label>
                <select
                  id="turma"
                  v-model="form.turma"
                  class="select"
                  required
                  :class="{ 'error': errors.turma }"
                >
                  <option value="">Carregando turmas...</option>
                  <option v-for="turma in turmas" :key="turma.id" :value="turma.nome">{{ turma.nome }}</option>
                </select>
                <span v-if="errors.turma" class="error-text">{{ errors.turma }}</span>
              </div>

              <div class="form-group">
                <label for="disciplina" class="label">Disciplina *</label>
                <select
                  id="disciplina"
                  v-model="form.disciplina"
                  class="select"
                  required
                  :class="{ 'error': errors.disciplina }"
                >
                  <option value="">Carregando disciplinas...</option>
                  <option v-for="disciplina in disciplinas" :key="disciplina.id" :value="disciplina.nome">{{ disciplina.nome }}</option>
                </select>
                <span v-if="errors.disciplina" class="error-text">{{ errors.disciplina }}</span>
              </div>

              <div class="form-group">
                <label for="professor" class="label">Professor *</label>
                <select
                  id="professor"
                  v-model="form.professor"
                  class="select"
                  required
                  :class="{ 'error': errors.professor }"
                >
                  <option value="">Carregando professores...</option>
                  <option v-for="professor in professores" :key="professor.id" :value="professor.nome">{{ professor.nome }}</option>
                </select>
                <span v-if="errors.professor" class="error-text">{{ errors.professor }}</span>
              </div>

              <div class="form-group">
                <label for="diasemana" class="label">Dia da Semana *</label>
                <select
                  id="diasemana"
                  v-model="form.diasemana"
                  class="select"
                  required
                  :class="{ 'error': errors.diasemana }"
                >
                  <option value="">Selecione o dia</option>
                  <option value="Segunda-feira">Segunda-feira</option>
                  <option value="Terça-feira">Terça-feira</option>
                  <option value="Quarta-feira">Quarta-feira</option>
                  <option value="Quinta-feira">Quinta-feira</option>
                  <option value="Sexta-feira">Sexta-feira</option>
                </select>
                <span v-if="errors.diasemana" class="error-text">{{ errors.diasemana }}</span>
              </div>

              <div class="form-group">
                <label for="horarioinicio" class="label">Horário de Início *</label>
                <input
                  type="time"
                  id="horarioinicio"
                  v-model="form.horarioinicio"
                  class="input"
                  required
                  :class="{ 'error': errors.horarioinicio }"
                >
                <span v-if="errors.horarioinicio" class="error-text">{{ errors.horarioinicio }}</span>
              </div>

              <div class="form-group">
                <label for="horariofinal" class="label">Horário de Fim</label>
                <input
                  type="time"
                  id="horariofinal"
                  v-model="form.horariofinal"
                  class="input"
                  :class="{ 'error': errors.horariofinal }"
                >
                <span v-if="errors.horariofinal" class="error-text">{{ errors.horariofinal }}</span>
              </div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-outline" @click="resetForm">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
              </svg>
              Limpar
            </button>
            <button type="submit" class="btn btn-primary" :disabled="isSubmitting">
              <svg v-if="!isSubmitting" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <svg v-else width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="animate-spin">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/>
              </svg>
              {{ isSubmitting ? (isEditMode ? 'Atualizando...' : 'Cadastrando...') : (isEditMode ? 'Atualizar Horário' : 'Cadastrar Horário') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://fsmnmggjklhxfkfnjxgc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzbW5tZ2dqa2xoeGZrZm5qeGdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDE0NTAsImV4cCI6MjA3MTE3NzQ1MH0.dMRH2DTAE8a1Vnyw9a8OiP5nTZetQy70hQgMV_a7jwo';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


    // Vue.js Application
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          form: {
            id: null,
            turma: '',
            disciplina: '',
            professor: '',
            diasemana: '',
            horarioinicio: '',
            horariofinal: ''
          },
          errors: {},
          isSubmitting: false,
          isEditMode: false,
          turmas: [],
          disciplinas: [],
          professores: []
        }
      },
      async mounted() {
        // Check if we're in edit mode (URL has an ID parameter)
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        
        if (id) {
          this.isEditMode = true;
          await this.carregarHorario(id);
        }
        
        // Update page title based on mode
        if (this.isEditMode) {
          document.title = 'Editar Horário - Escola One';
        }
        
        await this.carregarTurmas();
        await this.carregarDisciplinas();
        await this.carregarProfessores();
      },
      methods: {
        async carregarTurmas() {
          try {
            const { data, error } = await supabaseClient
              .from('turma')
              .select('id, nome')
              .order('nome', { ascending: true });

            if (error) {
              throw error;
            }

            this.turmas = data || [];
            
            // If no turmas found, add a placeholder
            if (this.turmas.length === 0) {
              this.turmas = [{ id: 0, nome: 'Nenhuma turma cadastrada' }];
            }
          } catch (error) {
            console.error('Erro ao carregar turmas:', error);
            this.turmas = [{ id: 0, nome: 'Erro ao carregar turmas' }];
          }
        },

        async carregarDisciplinas() {
          try {
            const { data, error } = await supabaseClient
              .from('disciplinas')
              .select('id, nome')
              .order('nome', { ascending: true });

            if (error) {
              throw error;
            }

            this.disciplinas = data || [];
            
            // If no disciplinas found, add a placeholder
            if (this.disciplinas.length === 0) {
              this.disciplinas = [{ id: 0, nome: 'Nenhuma disciplina cadastrada' }];
            }
          } catch (error) {
            console.error('Erro ao carregar disciplinas:', error);
            this.disciplinas = [{ id: 0, nome: 'Erro ao carregar disciplinas' }];
          }
        },

        async carregarProfessores() {
          try {
            const { data, error } = await supabaseClient
              .from('professor')
              .select('id, nome')
              .order('nome', { ascending: true });

            if (error) {
              throw error;
            }

            this.professores = data || [];
            
            // If no professores found, add a placeholder
            if (this.professores.length === 0) {
              this.professores = [{ id: 0, nome: 'Nenhum professor cadastrado' }];
            }
          } catch (error) {
            console.error('Erro ao carregar professores:', error);
            this.professores = [{ id: 0, nome: 'Erro ao carregar professores' }];
          }
        },

        async carregarHorario(id) {
          try {
            const { data, error } = await supabaseClient
              .from('horarios')
              .select('*')
              .eq('id', id)
              .single();

            if (error) {
              throw error;
            }

            if (data) {
              this.form = {
                id: data.id,
                turma: data.turma,
                disciplina: data.disciplina,
                professor: data.professor,
                diasemana: data.diasemana,
                horarioinicio: data.horarioinicio,
                horariofinal: data.horariofinal || ''
              };
            }
          } catch (error) {
            console.error('Erro ao carregar horário:', error);
            alert('Erro ao carregar dados do horário para edição.');
          }
        },

        validateForm() {
          this.errors = {};
          
          if (!this.form.turma) {
            this.errors.turma = 'Turma é obrigatória';
          }
          
          if (!this.form.disciplina) {
            this.errors.disciplina = 'Disciplina é obrigatória';
          }
          
          if (!this.form.professor) {
            this.errors.professor = 'Professor é obrigatório';
          }
          
          if (!this.form.diasemana) {
            this.errors.diasemana = 'Dia da semana é obrigatório';
          }
          
          if (!this.form.horarioinicio) {
            this.errors.horarioinicio = 'Horário de início é obrigatório';
          }

          // Validate time format and logic
          if (this.form.horarioinicio && this.form.horariofinal) {
            const inicio = new Date(`2000-01-01T${this.form.horarioinicio}`);
            const fim = new Date(`2000-01-01T${this.form.horariofinal}`);
            
            if (fim <= inicio) {
              this.errors.horariofinal = 'Horário de fim deve ser posterior ao horário de início';
            }
          }
          
          return Object.keys(this.errors).length === 0;
        },

        async submitForm() {
          if (!this.validateForm()) {
            return;
          }

          this.isSubmitting = true;
          
          try {
            let data, error;
            
            if (this.isEditMode && this.form.id) {
              // Update existing schedule
              const { data: updateData, error: updateError } = await supabaseClient
                .from('horarios')
                .update({
                  turma: this.form.turma,
                  disciplina: this.form.disciplina,
                  professor: this.form.professor,
                  diasemana: this.form.diasemana,
                  horarioinicio: this.form.horarioinicio,
                  horariofinal: this.form.horariofinal || null
                })
                .eq('id', this.form.id);
                
              data = updateData;
              error = updateError;
            } else {
              // Create new schedule
              const { data: insertData, error: insertError } = await supabaseClient
                .from('horarios')
                .insert([{
                  turma: this.form.turma,
                  disciplina: this.form.disciplina,
                  professor: this.form.professor,
                  diasemana: this.form.diasemana,
                  horarioinicio: this.form.horarioinicio,
                  horariofinal: this.form.horariofinal || null
                }]);
                
              data = insertData;
              error = insertError;
            }

            if (error) {
              throw error;
            }

            // Show success message
            this.showSuccessMessage();
            
            // Redirect to horarios.html after 2 seconds
            setTimeout(() => {
              window.location.href = 'horarios.html';
            }, 2000);
            
          } catch (error) {
            console.error('Erro ao salvar horário:', error);
            
            // Show error message
            this.showErrorMessage();
          } finally {
            this.isSubmitting = false;
          }
        },

        resetForm() {
          this.form = {
            id: null,
            turma: '',
            disciplina: '',
            professor: '',
            diasemana: '',
            horarioinicio: '',
            horariofinal: ''
          };
          this.errors = {};
          this.isEditMode = false;
        },

        showSuccessMessage() {
          const successMessage = document.getElementById('successMessage');
          const errorMessage = document.getElementById('errorMessage');
          
          errorMessage.style.display = 'none';
          successMessage.style.display = 'block';
          
          // Hide success message after 5 seconds
          setTimeout(() => {
            successMessage.style.display = 'none';
          }, 5000);
          
          // Scroll to top to show the message
          window.scrollTo({ top: 0, behavior: 'smooth' });
        },

        showErrorMessage() {
          const successMessage = document.getElementById('successMessage');
          const errorMessage = document.getElementById('errorMessage');
          
          successMessage.style.display = 'none';
          errorMessage.style.display = 'block';
          
          // Hide error message after 5 seconds
          setTimeout(() => {
            errorMessage.style.display = 'none';
          }, 5000);
          
          // Scroll to top to show the message
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }
    }).mount('#app');
  </script>

  <!-- Theme Manager -->
  <script src="theme-manager.js"></script>
</body>
</html>