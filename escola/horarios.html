<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão de Horários - Escola One</title>
  <link rel="stylesheet" href="design-system.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      background: hsl(var(--background));
      margin: 0;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: hsl(var(--card));
      border-bottom: 1px solid hsl(var(--border));
      padding: 1rem 2rem;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;
      box-sizing: border-box;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      width: 50px;
      height: 50px;
      border-radius: calc(var(--radius) * 2);
      overflow: hidden;
      background: hsl(var(--primary) / 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .brand-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: hsl(var(--foreground));
    }

    .brand-text .brand {
      color: hsl(var(--primary));
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .header-nav .nav-link {
      color: hsl(var(--muted-foreground));
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      transition: all 0.2s ease;
    }

    .header-nav .nav-link:hover {
      color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    .header-nav .nav-link.active {
      color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    /* Main Content */
    .main-content {
      margin-top: 70px;
      padding: 2rem;
      min-height: calc(100vh - 70px);
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-icon {
      width: 48px;
      height: 48px;
      background: hsl(var(--primary) / 0.1);
      color: hsl(var(--primary));
      border-radius: calc(var(--radius) * 1.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-icon svg {
      width: 24px;
      height: 24px;
    }

    .page-title {
      font-size: 2rem;
      font-weight: 700;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .page-subtitle {
      color: hsl(var(--muted-foreground));
      font-size: 0.875rem;
      margin: 0.25rem 0 0 0;
    }

    /* Search and Filter Bar */
    .search-bar {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 250px;
    }

    .filter-select {
      min-width: 150px;
    }

    /* Schedules Table */
    .schedules-section {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      overflow: hidden;
    }

    .table-header {
      padding: 1.5rem;
      border-bottom: 1px solid hsl(var(--border));
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .table-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .table-container {
      overflow-x: auto;
    }

    .schedules-table {
      width: 100%;
      border-collapse: collapse;
    }

    .schedules-table th {
      background: hsl(var(--muted) / 0.5);
      color: hsl(var(--muted-foreground));
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid hsl(var(--border));
    }

    .schedules-table td {
      padding: 1rem;
      border-bottom: 1px solid hsl(var(--border));
      vertical-align: middle;
    }

    .schedules-table tr:hover {
      background: hsl(var(--muted) / 0.3);
    }

    .schedules-table tr:last-child td {
      border-bottom: none;
    }

    .class-name {
      font-weight: 600;
      color: hsl(var(--foreground));
    }

    .subject-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .subject-name {
      font-weight: 500;
      color: hsl(var(--foreground));
    }

    .professor-name {
      font-weight: 500;
      color: hsl(var(--foreground));
    }

    .day-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .day-badge.segunda {
      background: hsl(0 100% 95%);
      color: hsl(0 100% 50%);
    }

    .day-badge.terca {
      background: hsl(45 100% 95%);
      color: hsl(45 100% 50%);
    }

    .day-badge.quarta {
      background: hsl(120 100% 95%);
      color: hsl(120 100% 40%);
    }

    .day-badge.quinta {
      background: hsl(200 100% 95%);
      color: hsl(200 100% 50%);
    }

    .day-badge.sexta {
      background: hsl(280 100% 95%);
      color: hsl(280 100% 50%);
    }

    [data-theme="dark"] .day-badge.segunda {
      background: hsl(0 100% 10%);
      color: hsl(0 100% 60%);
    }

    [data-theme="dark"] .day-badge.terca {
      background: hsl(45 100% 10%);
      color: hsl(45 100% 60%);
    }

    [data-theme="dark"] .day-badge.quarta {
      background: hsl(120 100% 10%);
      color: hsl(120 100% 60%);
    }

    [data-theme="dark"] .day-badge.quinta {
      background: hsl(200 100% 10%);
      color: hsl(200 100% 60%);
    }

    [data-theme="dark"] .day-badge.sexta {
      background: hsl(280 100% 10%);
      color: hsl(280 100% 60%);
    }

    .time-info {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .time-text {
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
    }

    .time-hours {
      font-weight: 600;
      color: hsl(var(--foreground));
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon svg {
      width: 16px;
      height: 16px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: hsl(var(--muted-foreground));
    }

    .empty-state svg {
      width: 80px;
      height: 80px;
      margin-bottom: 1rem;
      color: hsl(var(--muted-foreground) / 0.5);
    }

    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: hsl(var(--muted-foreground));
    }

    .empty-state p {
      margin-bottom: 1.5rem;
    }

    /* Loading State */
    .loading-state {
      text-align: center;
      padding: 2rem;
      color: hsl(var(--muted-foreground));
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid hsl(var(--muted));
      border-top: 3px solid hsl(var(--primary));
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .header-nav {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 1rem;
      }

      .main-content {
        padding: 1rem;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .search-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .search-input,
      .filter-select {
        min-width: auto;
      }

      .schedules-table {
        font-size: 0.875rem;
      }

      .schedules-table th,
      .schedules-table td {
        padding: 0.75rem 0.5rem;
      }
    }

  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Background Circle -->
          <circle cx="25" cy="25" r="25" fill="url(#logoGradient)"/>
          
          <!-- Book Icon -->
          <path d="M15 18C15 16.8954 15.8954 16 17 16H33C34.1046 16 35 16.8954 35 18V32C35 33.1046 34.1046 34 33 34H17C15.8954 34 15 33.1046 15 32V18Z" fill="white" fill-opacity="0.9"/>
          <path d="M18 20H32V22H18V20Z" fill="hsl(220 14% 96%)"/>
          <path d="M18 24H28V26H18V24Z" fill="hsl(220 14% 96%)"/>
          <path d="M18 28H30V30H18V28Z" fill="hsl(220 14% 96%)"/>
          
          <!-- Graduation Cap -->
          <path d="M25 12L35 16L25 20L15 16L25 12Z" fill="white"/>
          <path d="M32 18V22C32 23.1046 28.4183 24 25 24C21.5817 24 18 23.1046 18 22V18" stroke="white" stroke-width="1.5" fill="none"/>
          
          <!-- Number "1" -->
          <circle cx="39" cy="12" r="6" fill="white" fill-opacity="0.9"/>
          <text x="39" y="16" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="hsl(220 14% 20%)" text-anchor="middle">1</text>
          
          <!-- Gradient Definition -->
          <defs>
            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div class="brand-text">
        <span class="brand">Escola</span> One
      </div>
    </div>

    <nav class="header-nav">
      <a href="painel.html" class="nav-link">Home</a>
      <a href="alunos.html" class="nav-link">Alunos</a>
      <a href="encarregados.html" class="nav-link">Encarregados</a>
      <a href="professores.html" class="nav-link">Professores</a>
      <a href="disciplinas.html" class="nav-link">Disciplinas</a>
      <a href="turmas.html" class="nav-link">Turmas</a>
      <a href="horarios.html" class="nav-link active">Horários</a>
      <button id="theme-toggle" class="nav-link" style="background: none; border: none; cursor: pointer;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
        </svg>
      </button>
      <a href="#" class="nav-link" onclick="if(confirm('Tem certeza que deseja sair do sistema?')) { authManager.logout(); } return false;">Logout</a>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="page-header">
      <div class="page-title-section">
        <div class="page-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1 class="page-title">Gestão de Horários</h1>
          <p class="page-subtitle">Gerencie todos os horários das turmas</p>
        </div>
      </div>
      <button class="btn btn-primary" onclick="adicionarHorario()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
        </svg>
        Adicionar Horário
      </button>
    </div>

    <!-- Search and Filter Bar -->
    <div class="search-bar">
      <input 
        type="text" 
        class="input search-input" 
        placeholder="Pesquisar horários por turma, disciplina ou professor..."
        id="searchInput"
        oninput="filtrarHorarios()"
      >
      <select class="select filter-select" id="dayFilter" onchange="filtrarHorarios()">
        <option value="">Todos os dias</option>
      </select>
      <select class="select filter-select" id="classFilter" onchange="filtrarHorarios()">
        <option value="">Todas as turmas</option>
      </select>
    </div>

    <!-- Schedules Table -->
    <div class="schedules-section">
      <div class="table-header">
        <h2 class="table-title">Lista de Horários</h2>
        <span id="schedulesCount" class="badge badge-secondary">0 horários</span>
      </div>

      <!-- Loading State -->
      <div class="loading-state" id="loadingState">
        <div class="spinner"></div>
        <p>Carregando horários...</p>
      </div>

      <!-- Table Container -->
      <div class="table-container" id="tableContainer" style="display: none;">
        <table class="schedules-table">
          <thead>
            <tr>
              <th>Turma</th>
              <th>Disciplina</th>
              <th>Professor</th>
              <th>Dia da Semana</th>
              <th>Horário de Início</th>
              <th>Horário de Final</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="schedulesTableBody">
            <!-- Schedules will be inserted here -->
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <h3>Nenhum horário encontrado</h3>
        <p>Não há horários cadastrados ou que correspondam aos filtros aplicados.</p>
        <button class="btn btn-primary" onclick="adicionarHorario()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
          </svg>
          Adicionar Primeiro Horário
        </button>
      </div>
    </div>
  </main>

  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://fsmnmggjklhxfkfnjxgc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzbW5tZ2dqa2xoeGZrZm5qeGdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDE0NTAsImV4cCI6MjA3MTE3NzQ1MH0.dMRH2DTAE8a1Vnyw9a8OiP5nTZetQy70hQgMV_a7jwo';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let horariosc = [];
    let horariosFiltrados = [];

    // Sample data for demonstration
    const sampleHorarios = [
      {
        id: 1,
        turma: "1ª Classe A",
        disciplina: "Matemática",
        professor: "Prof. Carlos Silva",
        diasemana: "Segunda-feira",
        horarioinicio: "08:00",
        horariofinal: "09:00"
      },
      {
        id: 2,
        turma: "1ª Classe A",
        disciplina: "Português",
        professor: "Prof. Ana Santos",
        diasemana: "Segunda-feira",
        horarioinicio: "09:00",
        horariofinal: "10:00"
      },
      {
        id: 3,
        turma: "1ª Classe A",
        disciplina: "História",
        professor: "Prof. João Costa",
        diasemana: "Terça-feira",
        horarioinicio: "08:00",
        horariofinal: "09:00"
      },
      {
        id: 4,
        turma: "1ª Classe B",
        disciplina: "Matemática",
        professor: "Prof. Carlos Silva",
        diasemana: "Terça-feira",
        horarioinicio: "10:00",
        horariofinal: "11:00"
      },
      {
        id: 5,
        turma: "2ª Classe A",
        disciplina: "Geografia",
        professor: "Prof. Maria Fernandes",
        diasemana: "Quarta-feira",
        horarioinicio: "08:00",
        horariofinal: "09:00"
      },
      {
        id: 6,
        turma: "2ª Classe A",
        disciplina: "Ciências",
        professor: "Prof. Pedro Mendes",
        diasemana: "Quarta-feira",
        horarioinicio: "09:00",
        horariofinal: "10:00"
      },
      {
        id: 7,
        turma: "3ª Classe A",
        disciplina: "Inglês",
        professor: "Prof. Luisa Rodrigues",
        diasemana: "Quinta-feira",
        horarioinicio: "08:00",
        horariofinal: "09:00"
      },
      {
        id: 8,
        turma: "3ª Classe B",
        disciplina: "Educação Física",
        professor: "Prof. António Sousa",
        diasemana: "Sexta-feira",
        horarioinicio: "10:00",
        horariofinal: "11:00"
      },
      {
        id: 9,
        turma: "1ª Classe A",
        disciplina: "Informática",
        professor: "Prof. Sofia Alves",
        diasemana: "Quinta-feira",
        horarioinicio: "11:00",
        horariofinal: "12:00"
      },
      {
        id: 10,
        turma: "2ª Classe B",
        disciplina: "Português",
        professor: "Prof. Ana Santos",
        diasemana: "Sexta-feira",
        horarioinicio: "08:00",
        horariofinal: "09:00"
      }
    ];


    // Load schedules
    async function carregarHorarios() {
      try {
        showLoading();
        
        // Try to load from Supabase first
        try {
          const { data, error } = await supabaseClient
            .from('horarios')
            .select('*')
            .order('created_at', { ascending: false });

          if (error) {
            throw error;
          }

          horarios = data || [];
        } catch (supabaseError) {
          console.warn('Supabase não disponível, usando dados de exemplo:', supabaseError);
          // Use sample data if Supabase is not available
          horarios = sampleHorarios;
        }

        horariosFiltrados = [...horarios];
        renderizarTabela();
        updateSchedulesCount();
        populateFilterSelects(); // Populate filter selects with available options
        
      } catch (error) {
        console.error('Erro ao carregar horários:', error);
        // Fallback to sample data
        horarios = sampleHorarios;
        horariosFiltrados = [...horarios];
        renderizarTabela();
        updateSchedulesCount();
      } finally {
        hideLoading();
      }
    }

    // Get day badge class
    function getDayBadgeClass(dia) {
      switch(dia.toLowerCase()) {
        case 'segunda-feira': return 'segunda';
        case 'terça-feira': return 'terca';
        case 'quarta-feira': return 'quarta';
        case 'quinta-feira': return 'quinta';
        case 'sexta-feira': return 'sexta';
        default: return 'segunda';
      }
    }

    // Render schedules table
    function renderizarTabela() {
      const tbody = document.getElementById('schedulesTableBody');
      const tableContainer = document.getElementById('tableContainer');
      const emptyState = document.getElementById('emptyState');
      
      if (horariosFiltrados.length === 0) {
        tableContainer.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      tableContainer.style.display = 'block';
      
      tbody.innerHTML = horariosFiltrados.map(horario => {
        const dayClass = getDayBadgeClass(horario.diasemana);
        
        return `
          <tr>
            <td>
              <div class="class-name">${horario.turma}</div>
            </td>
            <td>
              <div class="subject-name">${horario.disciplina}</div>
            </td>
            <td>
              <div class="professor-name">${horario.professor}</div>
            </td>
            <td>
              <span class="day-badge ${dayClass}">${horario.diasemana}</span>
            </td>
            <td>
              <div class="time-info">
                <span class="time-hours">${horario.horarioinicio}</span>
              </div>
            </td>

             <td>
              <div class="time-info">
                <span class="time-hours">${horario.horariofinal}</span>
              </div>
            </td>

            <td>
              <div class="action-buttons">
                <button class="btn btn-outline btn-icon" onclick="editarHorario(${horario.id})" title="Editar">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                  </svg>
                </button>
                <button class="btn btn-destructive btn-icon" onclick="excluirHorario(${horario.id})" title="Excluir">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Filter schedules
    function filtrarHorarios() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const dayFilter = document.getElementById('dayFilter').value;
      const classFilter = document.getElementById('classFilter').value;

      horariosFiltrados = horarios.filter(horario => {
        const matchesSearch = !searchTerm ||
          horario.turma.toLowerCase().includes(searchTerm) ||
          horario.disciplina.toLowerCase().includes(searchTerm) ||
          horario.professor.toLowerCase().includes(searchTerm);

        const matchesDay = !dayFilter || horario.diasemana === dayFilter;
        const matchesClass = !classFilter || horario.turma === classFilter;

        return matchesSearch && matchesDay && matchesClass;
      });

      renderizarTabela();
      updateSchedulesCount();
      populateFilterSelects(); // Update filter options after filtering
    }

    // Populate filter selects with available options
    function populateFilterSelects() {
      // Get unique days and classes from horarios
      const uniqueDays = [...new Set(horarios.map(h => h.diasemana).filter(Boolean))];
      const uniqueClasses = [...new Set(horarios.map(h => h.turma).filter(Boolean))];

      // Populate day filter
      const dayFilter = document.getElementById('dayFilter');
      const currentDayValue = dayFilter.value;
      dayFilter.innerHTML = '<option value="">Todos os dias</option>';
      uniqueDays.sort().forEach(day => {
        const option = document.createElement('option');
        option.value = day;
        option.textContent = day;
        dayFilter.appendChild(option);
      });
      dayFilter.value = currentDayValue;

      // Populate class filter
      const classFilter = document.getElementById('classFilter');
      const currentClassValue = classFilter.value;
      classFilter.innerHTML = '<option value="">Todas as turmas</option>';
      uniqueClasses.sort().forEach(classe => {
        const option = document.createElement('option');
        option.value = classe;
        option.textContent = classe;
        classFilter.appendChild(option);
      });
      classFilter.value = currentClassValue;
    }

    // Update schedules count
    function updateSchedulesCount() {
      const count = horariosFiltrados.length;
      const countElement = document.getElementById('schedulesCount');
      countElement.textContent = `${count} horário${count !== 1 ? 's' : ''}`;
    }

    // Show loading state
    function showLoading() {
      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('tableContainer').style.display = 'none';
      document.getElementById('emptyState').style.display = 'none';
    }

    // Hide loading state
    function hideLoading() {
      document.getElementById('loadingState').style.display = 'none';
    }

    // Add schedule
    function adicionarHorario() {
      window.location.href = 'cadastrar-horario.html';
    }

    // Edit schedule
    function editarHorario(id) {
      // Redirect to schedule form with ID parameter for editing
      window.location.href = `cadastrar-horario.html?id=${id}`;
    }

    // Delete schedule
    async function excluirHorario(id) {
      const horario = horarios.find(h => h.id === id);
      if (!horario) return;

      if (!confirm(`Tem certeza que deseja excluir o horário "${horario.turma} - ${horario.disciplina}"?\n\nEsta ação não pode ser desfeita.`)) {
        return;
      }

      try {
        // Try to delete from Supabase
        const { error } = await supabaseClient
          .from('horarios')
          .delete()
          .eq('id', id);

        if (error) {
            throw error;
        }

        // Remove from local array
        horarios = horarios.filter(h => h.id !== id);
        filtrarHorarios();

        // Show success message
        alert('Horário excluído com sucesso!');
      } catch (error) {
        console.error('Erro ao excluir horário:', error);
        alert('Erro ao excluir horário. Por favor, tente novamente.');
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      carregarHorarios();
    });
  </script>

  <!-- Theme Manager -->
  <script src="theme-manager.js"></script>
  
  <!-- Auth Manager -->
  <script src="auth-manager.js"></script>
  <script>
    // Initialize auth manager and apply access control
    document.addEventListener('DOMContentLoaded', function() {
      const authManager = new AuthManager();
      authManager.verificarAutenticacao();
      authManager.aplicarControleAcesso();
    });
  </script>
</body>
</html>