<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão de Professores - Escola One</title>
  <link rel="stylesheet" href="design-system.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      background: hsl(var(--background));
      margin: 0;
      overflow-x: hidden;
    }

    /* Header */
    .header {
      background: hsl(var(--card));
      border-bottom: 1px solid hsl(var(--border));
      padding: 1rem 2rem;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 70px;
      box-sizing: border-box;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo {
      width: 50px;
      height: 50px;
      border-radius: calc(var(--radius) * 2);
      overflow: hidden;
      background: hsl(var(--primary) / 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .brand-text {
      font-size: 1.5rem;
      font-weight: 700;
      color: hsl(var(--foreground));
    }

    .brand-text .brand {
      color: hsl(var(--primary));
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 2rem;
    }

    .header-nav .nav-link {
      color: hsl(var(--muted-foreground));
      text-decoration: none;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      transition: all 0.2s ease;
    }

    .header-nav .nav-link:hover {
      color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    .header-nav .nav-link.active {
      color: hsl(var(--primary));
      background: hsl(var(--primary) / 0.1);
    }

    /* Main Content */
    .main-content {
      margin-top: 70px;
      padding: 2rem;
      min-height: calc(100vh - 70px);
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .page-icon {
      width: 48px;
      height: 48px;
      background: hsl(var(--primary) / 0.1);
      color: hsl(var(--primary));
      border-radius: calc(var(--radius) * 1.5);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-icon svg {
      width: 24px;
      height: 24px;
    }

    .page-title {
      font-size: 2rem;
      font-weight: 700;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .page-subtitle {
      color: hsl(var(--muted-foreground));
      font-size: 0.875rem;
      margin: 0.25rem 0 0 0;
    }

    /* Search and Filter Bar */
    .search-bar {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 250px;
    }

    .filter-select {
      min-width: 150px;
    }

    /* Teachers Table */
    .teachers-section {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      overflow: hidden;
    }

    .table-header {
      padding: 1.5rem;
      border-bottom: 1px solid hsl(var(--border));
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .table-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .table-container {
      overflow-x: auto;
    }

    .teachers-table {
      width: 100%;
      border-collapse: collapse;
    }

    .teachers-table th {
      background: hsl(var(--muted) / 0.5);
      color: hsl(var(--muted-foreground));
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid hsl(var(--border));
    }

    .teachers-table td {
      padding: 1rem;
      border-bottom: 1px solid hsl(var(--border));
      vertical-align: middle;
    }

    .teachers-table tr:hover {
      background: hsl(var(--muted) / 0.3);
    }

    .teachers-table tr:last-child td {
      border-bottom: none;
    }

    .teacher-name {
      font-weight: 600;
      color: hsl(var(--foreground));
    }

    .teacher-id {
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
      font-family: monospace;
    }

    .teacher-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .gender-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .gender-badge.masculino {
      background: hsl(220 100% 95%);
      color: hsl(220 100% 40%);
    }

    .gender-badge.feminino {
      background: hsl(320 100% 95%);
      color: hsl(320 100% 40%);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-icon svg {
      width: 16px;
      height: 16px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: hsl(var(--muted-foreground));
    }

    .empty-state svg {
      width: 80px;
      height: 80px;
      margin-bottom: 1rem;
      color: hsl(var(--muted-foreground) / 0.5);
    }

    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: hsl(var(--muted-foreground));
    }

    .empty-state p {
      margin-bottom: 1.5rem;
    }

    /* Loading State */
    .loading-state {
      text-align: center;
      padding: 2rem;
      color: hsl(var(--muted-foreground));
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid hsl(var(--muted));
      border-top: 3px solid hsl(var(--primary));
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .header-nav {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 1rem;
      }

      .main-content {
        padding: 1rem;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .search-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .search-input,
      .filter-select {
        min-width: auto;
      }

      .teachers-table {
        font-size: 0.875rem;
      }

      .teachers-table th,
      .teachers-table td {
        padding: 0.75rem 0.5rem;
      }
    }


    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: hsl(var(--card));
      border: 1px solid hsl(var(--border));
      border-radius: calc(var(--radius) * 2);
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid hsl(var(--border));
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: hsl(var(--foreground));
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      color: hsl(var(--muted-foreground));
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--radius);
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: hsl(var(--muted) / 0.5);
      color: hsl(var(--foreground));
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      padding: 1.5rem;
      border-top: 1px solid hsl(var(--border));
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    @media (max-width: 768px) {
      .modal-content {
        width: 95%;
        margin: 1rem;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .modal-footer {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
   <div class="header-left">
      <div class="logo">
        <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- Background Circle -->
          <circle cx="25" cy="25" r="25" fill="url(#logoGradient)"/>
          
          <!-- Book Icon -->
          <path d="M15 18C15 16.8954 15.8954 16 17 16H33C34.1046 16 35 16.8954 35 18V32C35 33.1046 34.1046 34 33 34H17C15.8954 34 15 33.1046 15 32V18Z" fill="white" fill-opacity="0.9"/>
          <path d="M18 20H32V22H18V20Z" fill="hsl(220 14% 96%)"/>
          <path d="M18 24H28V26H18V24Z" fill="hsl(220 14% 96%)"/>
          <path d="M18 28H30V30H18V28Z" fill="hsl(220 14% 96%)"/>
          
          <!-- Graduation Cap -->
          <path d="M25 12L35 16L25 20L15 16L25 12Z" fill="white"/>
          <path d="M32 18V22C32 23.1046 28.4183 24 25 24C21.5817 24 18 23.1046 18 22V18" stroke="white" stroke-width="1.5" fill="none"/>
          
          <!-- Number "1" -->
          <circle cx="39" cy="12" r="6" fill="white" fill-opacity="0.9"/>
          <text x="39" y="16" font-family="Arial, sans-serif" font-size="8" font-weight="bold" fill="hsl(220 14% 20%)" text-anchor="middle">1</text>
          
          <!-- Gradient Definition -->
          <defs>
            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div class="brand-text">
        <span class="brand">Escola</span> One
      </div>
    </div>

    <nav class="header-nav">
      <a href="painel.html" class="nav-link">Home</a>
      <a href="alunos.html" class="nav-link">Alunos</a>
      <a href="encarregados.html" class="nav-link">Encarregados</a>
      <a href="professores.html" class="nav-link active">Professores</a>
      <a href="disciplinas.html" class="nav-link">Disciplinas</a>
      <a href="turmas.html" class="nav-link">Turmas</a>
      <a href="horarios.html" class="nav-link">Horários</a>
      <a href="#" class="nav-link" onclick="if(confirm('Tem certeza que deseja sair do sistema?')) { authManager.logout(); } return false;">Logout</a>
    </nav>
  </header>


  <!-- Main Content -->
  <main class="main-content">
    <div class="page-header">
      <div class="page-title-section">
        <div class="page-icon">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 12c2.7 0 8 1.34 8 4v2H4v-2c0-2.66 5.3-4 8-4Zm0-2a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"/>
            <rect x="16" y="2" width="4" height="8" rx="2"/>
          </svg>
        </div>
        <div>
          <h1 class="page-title">Gestão de Professores</h1>
          <p class="page-subtitle">Gerencie todos os professores da escola</p>
        </div>
      </div>
      <button class="btn btn-primary" onclick="adicionarProfessor()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
        </svg>
        Adicionar Professor
      </button>
    </div>

    <!-- Search and Filter Bar -->
    <div class="search-bar">
      <input 
        type="text" 
        class="input search-input" 
        placeholder="Pesquisar professores por nome, bilhete ou telefone..."
        id="searchInput"
        oninput="filtrarProfessores()"
      >
      <select class="select filter-select" id="cursoFilter" onchange="filtrarProfessores()">
        <option value="">Todos os cursos</option>
        <option value="Ensino Fundamental">Ensino Fundamental</option>
        <option value="Ensino Médio">Ensino Médio</option>
        <option value="Ensino Técnico">Ensino Técnico</option>
        <option value="Ensino Superior">Ensino Superior</option>
      </select>
      <select class="select filter-select" id="disciplinaFilter" onchange="filtrarProfessores()">
        <option value="">Todas as disciplinas</option>
        <option value="Matemática">Matemática</option>
        <option value="Português">Português</option>
        <option value="História">História</option>
        <option value="Geografia">Geografia</option>
        <option value="Ciências">Ciências</option>
        <option value="Física">Física</option>
        <option value="Química">Química</option>
        <option value="Biologia">Biologia</option>
        <option value="Inglês">Inglês</option>
        <option value="Educação Física">Educação Física</option>
      </select>
    </div>

    <!-- Teachers Table -->
    <div class="teachers-section">
      <div class="table-header">
        <h2 class="table-title">Lista de Professores</h2>
        <span id="teachersCount" class="badge badge-secondary">0 professores</span>
      </div>

      <!-- Loading State -->
      <div class="loading-state" id="loadingState">
        <div class="spinner"></div>
        <p>Carregando professores...</p>
      </div>

      <!-- Table Container -->
      <div class="table-container" id="tableContainer" style="display: none;">
        <table class="teachers-table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Bilhete</th>
              <th>Gênero</th>
              <th>Telefone</th>
              <th>Email</th>
              <th>Cidade</th>
              <th>Curso</th>
              <th>Disciplina</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="teachersTableBody">
            <!-- Teachers will be inserted here -->
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 12c2.7 0 8 1.34 8 4v2H4v-2c0-2.66 5.3-4 8-4Zm0-2a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"/>
          <rect x="16" y="2" width="4" height="8" rx="2"/>
        </svg>
        <h3>Nenhum professor encontrado</h3>
        <p>Não há professores cadastrados ou que correspondam aos filtros aplicados.</p>
        <button class="btn btn-primary" onclick="adicionarProfessor()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
          </svg>
          Adicionar Primeiro Professor
        </button>
      </div>
    </div>
  </main>

  <!-- Modal para Editar Professor -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Editar Professor</h3>
        <button class="modal-close" onclick="fecharModalEdicao()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="editForm" class="form-grid">
          <div class="form-group">
            <label for="editNome" class="label">Nome Completo *</label>
            <input type="text" id="editNome" class="input" required>
            <span class="error-message" id="editNomeError"></span>
          </div>
          
          <div class="form-group">
            <label for="editBilhete" class="label">Bilhete de Identidade *</label>
            <input type="text" id="editBilhete" class="input" required>
            <span class="error-message" id="editBilheteError"></span>
          </div>
          
          <div class="form-group">
            <label for="editGenero" class="label">Gênero *</label>
            <select id="editGenero" class="select" required>
              <option value="">Selecione o gênero</option>
              <option value="Masculino">Masculino</option>
              <option value="Feminino">Feminino</option>
            </select>
            <span class="error-message" id="editGeneroError"></span>
          </div>
          
          <div class="form-group">
            <label for="editTelefone" class="label">Telefone *</label>
            <input type="tel" id="editTelefone" class="input" required>
            <span class="error-message" id="editTelefoneError"></span>
          </div>
          
          <div class="form-group full-width">
            <label for="editEmail" class="label">Email *</label>
            <input type="email" id="editEmail" class="input" required>
            <span class="error-message" id="editEmailError"></span>
          </div>
          
          <div class="form-group">
            <label for="editCidade" class="label">Cidade *</label>
            <input type="text" id="editCidade" class="input" required>
            <span class="error-message" id="editCidadeError"></span>
          </div>
          
          <div class="form-group">
            <label for="editCurso" class="label">Curso *</label>
            <select id="editCurso" class="select" required>
              <option value="">Selecione o curso</option>
              <option value="Ensino Fundamental">Ensino Fundamental</option>
              <option value="Ensino Médio">Ensino Médio</option>
              <option value="Ensino Técnico">Ensino Técnico</option>
              <option value="Ensino Superior">Ensino Superior</option>
            </select>
            <span class="error-message" id="editCursoError"></span>
          </div>
          
          <div class="form-group full-width">
            <label for="editDisciplina" class="label">Disciplina *</label>
            <select id="editDisciplina" class="select" required>
              <option value="">Selecione a disciplina</option>
              <option value="Matemática">Matemática</option>
              <option value="Português">Português</option>
              <option value="História">História</option>
              <option value="Geografia">Geografia</option>
              <option value="Ciências">Ciências</option>
              <option value="Física">Física</option>
              <option value="Química">Química</option>
              <option value="Biologia">Biologia</option>
              <option value="Inglês">Inglês</option>
              <option value="Educação Física">Educação Física</option>
            </select>
            <span class="error-message" id="editDisciplinaError"></span>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" onclick="fecharModalEdicao()">Cancelar</button>
        <button type="button" class="btn btn-primary" onclick="salvarEdicaoProfessor()">Salvar Alterações</button>
      </div>
    </div>
  </div>

  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://fsmnmggjklhxfkfnjxgc.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzbW5tZ2dqa2xoeGZrZm5qeGdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2MDE0NTAsImV4cCI6MjA3MTE3NzQ1MH0.dMRH2DTAE8a1Vnyw9a8OiP5nTZetQy70hQgMV_a7jwo';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let professores = [];
    let professoresFiltrados = [];

    // Sample data for demonstration
    const sampleProfessores = [
      {
        id: 1,
        nome: "Maria Silva Santos",
        bilhete: "004567890LA041",
        cidade: "Luanda",
        genero: "Feminino",
        telefone: "+244 923 456 789",
        email: "maria.silva@escolaone.ao",
        curso: "Ensino Médio",
        disciplina: "Matemática"
      },
      {
        id: 2,
        nome: "João Carlos Mendes",
        bilhete: "005678901LA042",
        cidade: "Benguela",
        genero: "Masculino",
        telefone: "+244 934 567 890",
        email: "joao.mendes@escolaone.ao",
        curso: "Ensino Fundamental",
        disciplina: "Português"
      },
      {
        id: 3,
        nome: "Ana Paula Costa",
        bilhete: "006789012LA043",
        cidade: "Huambo",
        genero: "Feminino",
        telefone: "+244 945 678 901",
        email: "ana.costa@escolaone.ao",
        curso: "Ensino Médio",
        disciplina: "História"
      },
      {
        id: 4,
        nome: "Pedro Miguel Fernandes",
        bilhete: "007890123LA044",
        cidade: "Lubango",
        genero: "Masculino",
        telefone: "+244 956 789 012",
        email: "pedro.fernandes@escolaone.ao",
        curso: "Ensino Técnico",
        disciplina: "Física"
      },
      {
        id: 5,
        nome: "Carla Beatriz Rodrigues",
        bilhete: "008901234LA045",
        cidade: "Cabinda",
        genero: "Feminino",
        telefone: "+244 967 890 123",
        email: "carla.rodrigues@escolaone.ao",
        curso: "Ensino Superior",
        disciplina: "Biologia"
      }
    ];


    // Load teachers
    async function carregarProfessores() {
      try {
        showLoading();
        
        // Try to load from Supabase first
        try {
          const { data, error } = await supabaseClient
            .from('professor')
            .select('*')
            .order('created_at', { ascending: false });

          if (error) {
            throw error;
          }

          professores = data || [];
        } catch (supabaseError) {
          console.warn('Supabase não disponível, usando dados de exemplo:', supabaseError);
          // Use sample data if Supabase is not available
          professores = sampleProfessores;
        }

        professoresFiltrados = [...professores];
        renderizarTabela();
        updateTeachersCount();
        
      } catch (error) {
        console.error('Erro ao carregar professores:', error);
        // Fallback to sample data
        professores = sampleProfessores;
        professoresFiltrados = [...professores];
        renderizarTabela();
        updateTeachersCount();
      } finally {
        hideLoading();
      }
    }

    // Render teachers table
    function renderizarTabela() {
      const tbody = document.getElementById('teachersTableBody');
      const tableContainer = document.getElementById('tableContainer');
      const emptyState = document.getElementById('emptyState');
      
      if (professoresFiltrados.length === 0) {
        tableContainer.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      tableContainer.style.display = 'block';
      
      tbody.innerHTML = professoresFiltrados.map(professor => `
        <tr>
          <td>
            <div class="teacher-info">
              <div class="teacher-name">${professor.nome}</div>
             
            </div>
          </td>

        <td>${professor.bilhete || 'N/A'}</td>
          
           <td>
            <span class="gender-badge ${professor.genero ? professor.genero.toLowerCase() : ''}">${professor.genero || 'N/A'}</span>
          </td>
          <td>${professor.telefone || 'N/A'}</td>
          <td>${professor.email || 'N/A'}</td>
          <td>${professor.cidade || 'N/A'}</td>
          <td>
            <span class="badge badge-outline">${professor.curso || 'N/A'}</span>
          </td>
          <td>
            <span class="badge badge-secondary">${professor.disciplina || 'N/A'}</span>
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-outline btn-icon" onclick="editarProfessor(${professor.id})" title="Editar">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
              </button>
              <button class="btn btn-destructive btn-icon" onclick="eliminarProfessor(${professor.id})" title="Eliminar">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Filter teachers
    function filtrarProfessores() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const cursoFilter = document.getElementById('cursoFilter').value;
      const disciplinaFilter = document.getElementById('disciplinaFilter').value;

      professoresFiltrados = professores.filter(professor => {
        const matchesSearch = !searchTerm ||
          professor.nome.toLowerCase().includes(searchTerm) ||
          (professor.bilhete && professor.bilhete.toLowerCase().includes(searchTerm)) ||
          (professor.telefone && professor.telefone.includes(searchTerm));

        const matchesCurso = !cursoFilter || professor.curso === cursoFilter;
        const matchesDisciplina = !disciplinaFilter || professor.disciplina === disciplinaFilter;

        return matchesSearch && matchesCurso && matchesDisciplina;
      });

      renderizarTabela();
      updateTeachersCount();
    }

    // Update teachers count
    function updateTeachersCount() {
      const count = professoresFiltrados.length;
      const countElement = document.getElementById('teachersCount');
      countElement.textContent = `${count} ${count === 1 ? 'professor' : 'professores'}`;
    }

    // Show loading state
    function showLoading() {
      document.getElementById('loadingState').style.display = 'block';
      document.getElementById('tableContainer').style.display = 'none';
      document.getElementById('emptyState').style.display = 'none';
    }

    // Hide loading state
    function hideLoading() {
      document.getElementById('loadingState').style.display = 'none';
    }

    // Show error
    function showError(message) {
      alert(message); // In a real app, you'd use a proper notification system
    }

    // Add teacher
    function adicionarProfessor() {
      window.location.href = 'cadastrar-professor.html';
    }

    // Edit teacher
    function editarProfessor(id) {
      const professor = professores.find(p => p.id === id);
      if (!professor) {
        alert('Professor não encontrado!');
        return;
      }

      // Preencher o formulário com os dados do professor
      document.getElementById('editNome').value = professor.nome || '';
      document.getElementById('editBilhete').value = professor.bilhete || '';
      document.getElementById('editGenero').value = professor.genero || '';
      document.getElementById('editTelefone').value = professor.telefone || '';
      document.getElementById('editEmail').value = professor.email || '';
      document.getElementById('editCidade').value = professor.cidade || '';
      document.getElementById('editCurso').value = professor.curso || '';
      document.getElementById('editDisciplina').value = professor.disciplina || '';

      // Armazenar o ID do professor sendo editado
      document.getElementById('editForm').dataset.professorId = id;

      // Limpar erros anteriores
      limparErrosEdicao();

      // Mostrar o modal
      document.getElementById('editModal').classList.add('show');
    }

    // Fechar modal de edição
    function fecharModalEdicao() {
      document.getElementById('editModal').classList.remove('show');
      limparErrosEdicao();
    }

    // Limpar erros de edição
    function limparErrosEdicao() {
      const errorElements = document.querySelectorAll('#editModal .error-message');
      errorElements.forEach(element => {
        element.textContent = '';
      });

      const inputElements = document.querySelectorAll('#editModal .input, #editModal .select');
      inputElements.forEach(element => {
        element.classList.remove('error');
      });
    }

    // Validar campo de edição
    function validarCampoEdicao(campo, valor, mensagem) {
      const errorElement = document.getElementById(`edit${campo}Error`);
      const inputElement = document.getElementById(`edit${campo}`);
      
      if (!valor || valor.trim() === '') {
        errorElement.textContent = mensagem;
        inputElement.classList.add('error');
        return false;
      }
      
      errorElement.textContent = '';
      inputElement.classList.remove('error');
      return true;
    }

    // Salvar edição do professor
    async function salvarEdicaoProfessor() {
      const form = document.getElementById('editForm');
      const professorId = parseInt(form.dataset.professorId);

      // Obter valores do formulário
      const nome = document.getElementById('editNome').value.trim();
      const bilhete = document.getElementById('editBilhete').value.trim();
      const genero = document.getElementById('editGenero').value;
      const telefone = document.getElementById('editTelefone').value.trim();
      const email = document.getElementById('editEmail').value.trim();
      const cidade = document.getElementById('editCidade').value.trim();
      const curso = document.getElementById('editCurso').value;
      const disciplina = document.getElementById('editDisciplina').value;

      // Validar campos
      let isValid = true;
      
      if (!validarCampoEdicao('Nome', nome, 'Nome é obrigatório')) isValid = false;
      if (!validarCampoEdicao('Bilhete', bilhete, 'Bilhete de identidade é obrigatório')) isValid = false;
      if (!validarCampoEdicao('Genero', genero, 'Gênero é obrigatório')) isValid = false;
      if (!validarCampoEdicao('Telefone', telefone, 'Telefone é obrigatório')) isValid = false;
      if (!validarCampoEdicao('Email', email, 'Email é obrigatório')) isValid = false;
      if (!validarCampoEdicao('Cidade', cidade, 'Cidade é obrigatória')) isValid = false;
      if (!validarCampoEdicao('Curso', curso, 'Curso é obrigatório')) isValid = false;
      if (!validarCampoEdicao('Disciplina', disciplina, 'Disciplina é obrigatória')) isValid = false;

      // Validação específica de email
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        document.getElementById('editEmailError').textContent = 'Email inválido';
        document.getElementById('editEmail').classList.add('error');
        isValid = false;
      }

      if (!isValid) {
        return;
      }

      try {
        const professorAtualizado = {
          nome,
          bilhete,
          genero,
          telefone,
          email,
          cidade,
          curso,
          disciplina
        };

        // Tentar atualizar no Supabase
        try {
          const { error } = await supabaseClient
            .from('professor')
            .update(professorAtualizado)
            .eq('id', professorId);

          if (error) {
            throw error;
          }
        } catch (supabaseError) {
          console.warn('Supabase não disponível, atualizando dados locais:', supabaseError);
          // Atualizar nos dados locais se Supabase não estiver disponível
          const index = professores.findIndex(p => p.id === professorId);
          if (index > -1) {
            professores[index] = { ...professores[index], ...professorAtualizado };
          }
        }

        alert('Professor atualizado com sucesso!');
        fecharModalEdicao();
        await carregarProfessores(); // Recarregar a lista
        
      } catch (error) {
        console.error('Erro ao atualizar professor:', error);
        alert('Erro ao atualizar professor: ' + error.message);
      }
    }

    // Delete teacher
    async function eliminarProfessor(id) {
      const professor = professores.find(p => p.id === id);
      if (!professor) return;

      if (!confirm(`Tem certeza que deseja eliminar o professor "${professor.nome}"?\n\nEsta ação não pode ser desfeita.`)) {
        return;
      }

      try {
        // Try to delete from Supabase first
        try {
          const { error } = await supabaseClient
            .from('professor')
            .delete()
            .eq('id', id);

          if (error) {
            throw error;
          }
        } catch (supabaseError) {
          console.warn('Supabase não disponível, removendo dos dados locais:', supabaseError);
          // Remove from local data if Supabase is not available
          const index = professores.findIndex(p => p.id === id);
          if (index > -1) {
            professores.splice(index, 1);
          }
        }

        alert('Professor eliminado com sucesso!');
        await carregarProfessores(); // Reload the list
        
      } catch (error) {
        console.error('Erro ao eliminar professor:', error);
        alert('Erro ao eliminar professor: ' + error.message);
      }
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      carregarProfessores();
    });
  </script>

  <!-- Theme Manager -->
  <script src="theme-manager.js"></script>
  
  <!-- Auth Manager -->
  <script src="auth-manager.js"></script>
  <script>
    // Initialize auth manager and apply access control
    document.addEventListener('DOMContentLoaded', function() {
      const authManager = new AuthManager();
      authManager.verificarAutenticacao();
      authManager.aplicarControleAcesso();
    });
  </script>
</body>
</html>

      